doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title Suppliers - Mayondo Wood And Furniture
    link(rel="stylesheet", href="/CSS/suppliers.css")

  body
    // Navbar
    header.navbar
      .brand
        a(href="/")
          img(src="/Images/mayondo logo.png", alt="Company Logo")
        h2 Mayondo Wood And Furniture
      nav.nav-links
        a(href="/saleslist") Sales
        a(href="/stafflist") Register
        .dropdown
          a(href="/analytic") Reports ▼
          .dropdown-content
            a(href="/accounting") Accounting
            a(href="/stafflist") Staff
            a(href="/suppliers") Suppliers
        a(href="/stockreport") Stock
        if user
          a(href="#" onclick="showLogoutConfirmation()" class="btn-logout" style="background-color: red; color: white; padding: 8px 16px; border-radius: 4px; text-decoration: none; display: inline-block;") Logout

    // Main content
    main.container
      .card
        .card-header(style="background-color: #8B4513 !important; color: white !important;")
          h2(style="color: white !important;") Suppliers List

        // Suppliers Table
        table#suppliersTable
          thead
            tr
              th Supplier
              th Email
              th Contact
              th Products
              th Status
              th Actions
          tbody
            if suppliers.length
              each supplier in suppliers
                tr
                  td= supplier.supplierName || "N/A"
                  td= supplier.supplierEmail || "N/A"
                  td= supplier.supplierContact || "N/A"
                  td= supplier.products && supplier.products.length ? supplier.products.join(", ") : "N/A"
                  td
                    span.status-badge(class=supplier.status === 'active' ? 'active' : 'inactive')= supplier.status === 'active' ? 'Active' : 'Inactive'
                  td
                    button.delete-btn.action-btn(
                      type="button",
                      onclick=`showDeleteConfirmation('${(supplier.supplierName || '').replace(/'/g, "\\'")}', '${(supplier.supplierName || '').replace(/'/g, "\\'")}', 'supplier')`
                    ) Delete

            else
              tr
                td(colspan="6") No suppliers found.

    // Delete Confirmation Modal
    #deleteModal.modal(style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);")
      .modal-content(style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); position: relative;")
        .modal-header(style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;")
          h3(style="margin: 0; color: #d9534f;") Confirm Deletion
        .modal-body(style="margin-bottom: 20px;")
          p#deleteMessage(style="margin: 0;") Are you sure you want to delete this supplier?
          p(style="margin: 10px 0 0 0; font-weight: bold;") #[span#deleteDetails]
        .modal-footer(style="text-align: right;")
          form#deleteForm(method="POST", style="display: inline;")
            button.btn.btn-danger(type="button", onclick="submitDeleteForm()") Delete
          button.btn.btn-secondary(type="button", onclick="closeDeleteModal()", style="margin-left: 10px;") Cancel

    // Logout Confirmation Modal
    #logoutModal.modal(style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);")
      .modal-content(style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);")
        .modal-header(style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;")
          h3(style="margin: 0; color: #d9534f;") Confirm Logout
        .modal-body(style="margin-bottom: 20px;")
          p#logoutMessage(style="margin: 0;") Are you sure you want to log out?
        .modal-footer(style="text-align: right;")
          button.btn.btn-danger(type="button", onclick="confirmLogout()") Logout
          button.btn.btn-secondary(type="button", onclick="closeLogoutModal()", style="margin-left: 10px;") Cancel

    style.
      .status-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
      }
      .status-badge.active {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status-badge.inactive {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .action-btn {
        padding: 6px 12px;
        margin: 2px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      .delete-btn {
        background-color: #dc3545;
        color: white;
      }
      .delete-btn:hover {
        background-color: #c82333;
      }

    script.
      function showLogoutConfirmation() {
        document.getElementById('logoutModal').style.display = 'block';
      }

      function closeLogoutModal() {
        document.getElementById('logoutModal').style.display = 'none';
      }

      function confirmLogout() {
        window.location.href = '/logout';
      }

      function showDeleteConfirmation(supplierName, displayName, supplierType) {
        console.log('Delete confirmation called for:', supplierName);
        document.getElementById('deleteMessage').textContent = `Are you sure you want to delete this ${supplierType}?`;
        document.getElementById('deleteDetails').textContent = `${displayName}`;

        const encodedName = encodeURIComponent(supplierName);
        const actionUrl = `/suppliers/delete/${encodedName}`;
        console.log('Setting form action to:', actionUrl);

        document.getElementById('deleteForm').action = actionUrl;
        document.getElementById('deleteModal').style.display = 'block';
      }

      function submitDeleteForm() {
        const form = document.getElementById('deleteForm');
        console.log('Submitting form with action:', form.action);
        console.log('Form method:', form.method);

        // Submit the form programmatically
        form.submit();
      }

      // Close modals when clicking outside of them
      window.onclick = function(event) {
        const deleteModal = document.getElementById('deleteModal');
        const logoutModal = document.getElementById('logoutModal');
        if (event.target === deleteModal) {
          deleteModal.style.display = 'none';
        }
        if (event.target === logoutModal) {
          logoutModal.style.display = 'none';
        }
      }

    // Footer
    footer(style="text-align: center; padding: 20px; background-color: #5d4037; color: white;")
      h3 Connect With Us
      .footer-bottom
        | © 2025 Your Company Name. All rights reserved.

    script(src="/Javascript/suppliers.js")
