doctype html
html(lang="en")
  head
    meta(charset="utf-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    link(rel="stylesheet", href="/CSS/ecommerce.css")

  body
    // =========================
    // Header + Navbar
    // =========================
    header.main-navbar
      .brand
        a(href="/")
          img(src="/Images/mayondo logo.png", alt="Company Logo")
          h2 Mayondo Furniture & Wood
        .search-container
          input(type="text", placeholder="Search products...")

    // =========================
    // Staff Navigation Bar
    // =========================
    if user && user.position && (user.position === "sales Agent" || user.position === "manager")
      nav.staff-navbar
        .staff-nav-container
          .staff-nav-left
            a.staff-link(href="/admin/upload")
              span.icon ğŸ“Š
              span.text Stock update
            a.staff-link(href="/orders")
              span.icon ğŸ“‹
              span.text Orders
            a.staff-link(href="/addsale")
              span.icon ğŸ’°
              span.text Sales
            a.staff-link.primary(href="/ecommerce")
              span.icon ğŸ›’
              span.text Store
          .staff-nav-right
            span.welcome Welcome, #{user.fullname}!
            a.logout-btn(href="#" onclick="showLogoutConfirmation()") Logout

    // =========================
    // Main Content
    // =========================
    .container
      // Slideshow
      .slideshow-container
        .slide.active
          img(src="/Images/sofa set.jpeg", alt="Sofa Sale")
          .promo-text
            h2 ğŸ”¥ Sofa Sale â€“ 20% Off
            p Limited time offer on all sofa sets
        .slide
          img(src="/Images/bed room.jpeg", alt="New Beds")
          .promo-text
            h2 ğŸ› New Beds 2025
            p Modern designs for your comfort
        .slide
          img(src="/Images/dinning.jpeg", alt="Free Delivery")
          .promo-text
            h2 ğŸšš Free Delivery
            p On all orders above $200

        .slideshow-controls
          button.btn-slide#prevBtn(type="button" aria-label="Previous Slide") â€¹
          button.btn-slide#nextBtn(type="button" aria-label="Next Slide") â€º

      // Product Grid + Cart
      .wrap
        // Product Grid
        main
          #productGrid
            if products && products.length
              each product in products
                .card
                  .img-wrap
                    img(
                      src=product.img,
                      alt=product.name,
                      onerror="this.src='/Images/no-image.png'"
                    )
                  .meta
                    h4.title= product.name
                    .price UGX #{product.price}
                  .actions
                    button.add-to-cart(
                      type="button",
                      data-id=product._id,
                      data-name=product.name,
                      data-price=product.price
                    ) Add to Cart

                    // Staff-only actions
                    if user && user.position && (user.position === "sales Agent" || user.position === "manager")
                      a.btn-edit(href=`/ecommerce/product/edit/${product._id}`) Edit
                      button.btn-delete(
                        type="button",
                        onclick=`showDeleteConfirmation('${product._id}', '${product.name}', 'product')`
                      ) Delete
            else
              p.no-products No products to show.

        // Cart Section
        aside.cart(aria-label="Shopping cart")
          h3 Your Cart

          .form-group
            .field
              label(for="customerName") Name
              input#customerName(type="text", required, placeholder="Enter your name")

            .field
              label(for="phoneNumber") Contact
              input#phoneNumber(type="text", required, placeholder="Enter your phone number")

            .field
              label(for="address") Address
              input#address(type="text", required, placeholder="Enter your address")

          ul#cartList
          .total
            span Total:
            span#total UGX 0

          button#checkoutBtn(type="button") Checkout

    // =========================
    // Delete Confirmation Modal
    // =========================
    #deleteModal.modal(style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);")
      .modal-content(style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);")
        .modal-header(style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;")
          h3(style="margin: 0; color: #d9534f;") Confirm Deletion
        .modal-body(style="margin-bottom: 20px;")
          p#deleteMessage(style="margin: 0;") Are you sure you want to delete this product?
          p(style="margin: 10px 0 0 0; font-weight: bold;") #[span#deleteDetails]
        .modal-footer(style="text-align: right;")
          form#deleteForm(method="post", style="display: inline;")
            button.btn.btn-danger(type="submit") Delete
          button.btn.btn-secondary(type="button", onclick="closeDeleteModal()", style="margin-left: 10px;") Cancel

    // =========================
    // Logout Confirmation Modal
    // =========================
    #logoutModal.modal(style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);")
      .modal-content(style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);")
        .modal-header(style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;")
          h3(style="margin: 0; color: #d9534f;") Confirm Logout
        .modal-body(style="margin-bottom: 20px;")
          p#logoutMessage(style="margin: 0;") Are you sure you want to log out?
        .modal-footer(style="text-align: right;")
          button.btn.btn-danger(type="button", onclick="confirmLogout()") Logout
          button.btn.btn-secondary(type="button", onclick="closeLogoutModal()", style="margin-left: 10px;") Cancel

    // =========================
    // Success Modal
    // =========================
    #successModal.modal(style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);")
      .modal-content(style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 500px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); animation: successModal 0.3s ease-out;")
        .modal-header(style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px; text-align: center;")
          h3(style="margin: 0; color: #5cb85c;") ğŸ‰ Order Placed Successfully!
        .modal-body(style="margin-bottom: 20px; text-align: center;")
          p#successMessage(style="margin: 0; font-size: 16px;") Your order has been placed successfully.
          p(style="margin: 10px 0 0 0; font-weight: bold; color: #5cb85c;") #[span#orderId] Thank you for shopping with us!
        .modal-footer(style="text-align: center;")
          button.btn.btn-success(type="button", onclick="closeSuccessModal()", style="padding: 10px 30px; font-size: 16px;") Continue Shopping

    // =========================
    // Modal Animation
    // =========================
    style.
      @keyframes successModal {
        from {
          opacity: 0;
          transform: scale(0.8) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

    // =========================
    // Script Logic
    // =========================
    script.
      function showLogoutConfirmation() {
        document.getElementById('logoutModal').style.display = 'block';
      }

      function closeLogoutModal() {
        document.getElementById('logoutModal').style.display = 'none';
      }

      function confirmLogout() {
        window.location.href = '/logout';
      }

      function showDeleteConfirmation(productId, productName, productType) {
        document.getElementById('deleteMessage').textContent = `Are you sure you want to delete this ${productType}?`;
        document.getElementById('deleteDetails').textContent = `${productName}`;
        document.getElementById('deleteForm').action = `/ecommerce/product/delete/${productId}`;
        document.getElementById('deleteModal').style.display = 'block';
      }

      function closeDeleteModal() {
        document.getElementById('deleteModal').style.display = 'none';
      }

      function showSuccessModal(message, orderId) {
        document.getElementById('successMessage').textContent = message || 'Your order has been placed successfully.';
        document.getElementById('orderId').textContent = orderId ? `Order #${orderId}` : 'Thank you for shopping with us!';
        document.getElementById('successModal').style.display = 'block';
      }

      function closeSuccessModal() {
        document.getElementById('successModal').style.display = 'none';
      }

      window.onclick = function(event) {
        const modals = ['deleteModal', 'logoutModal', 'successModal'];
        modals.forEach(id => {
          const modal = document.getElementById(id);
          if (event.target === modal) modal.style.display = 'none';
        });
      }

    // =========================
    // Footer
    // =========================
    footer
      h3 Connect With Us
      .footer-links
        a(href="mailto:info@yourcompany.com") ğŸ“§ Email
        a(href="tel:+1234567890") ğŸ“ Phone
        a(href="https://wa.me/1234567890", target="_blank") ğŸ’¬ WhatsApp
        a(href="https://facebook.com/yourpage", target="_blank") ğŸ“˜ Facebook
        a(href="https://instagram.com/yourpage", target="_blank") ğŸ“¸ Instagram
        a(href="https://twitter.com/yourpage", target="_blank") ğŸ¦ Twitter
      .footer-bottom Â© 2025 Your Company Name. All rights reserved.

    // =========================
    // External Scripts
    // =========================
    script(src="/Javascript/ecommerce.js")
    script(src="/Javascript/search.js")
