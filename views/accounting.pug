doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title Manager Dashboard
    link(rel="stylesheet", href="/CSS/accounting.css")
    script(src="https://cdn.jsdelivr.net/npm/chart.js") // Include Chart.js


  body
    // Navbar
    header.navbar
      .brand
        a(href="/")
          img(src="/Images/mayondo logo.png", alt="Company Logo")
        h2 Mayondo Wood And Furniture
      nav.nav-links
        a(href="/saleslist") Sales
        a(href="/stafflist") Register
        .dropdown
          a(href="/analytic") Reports ▼
          .dropdown-content
            a(href="/accounting") Accounting
            a(href="/dashboard") Manager
            a(href="/suppliers") Suppliers
        a(href="/stockreport") Stock
        if user
          a(href="#" onclick="showLogoutConfirmation()" class="btn-logout" style="background-color: red; color: white; padding: 8px 16px; border-radius: 4px; text-decoration: none; display: inline-block;") Logout
    form(action="/accounting" method="post", style="width: calc(100% - 80px); margin: 0 40px; padding: 0 40px; box-sizing: border-box;")
      .form-header(style="display: flex; justify-content: flex-start; margin-bottom: 20px;")
        h1(style="margin: 0; font-size: 24px; color: #333;") Accounting Dashboard
      .form-section(style="display: block; width: 100%;")
        h2 Enter Financial Data
        .form-group
          label Sales (ugx): 
          input(type="number", name="sales", required, value=data.sales || "", style="width: 100%; box-sizing: border-box;")
        .form-group
          label COGS (ugx): 
          input(type="number", name="cogs", required, value=data.cogs || "", style="width: 100%; box-sizing: border-box;")
        .form-group
          label Expenses (ugx): 
          input(type="number", name="expenses", required, value=data.expenses || "", style="width: 100%; box-sizing: border-box;")
        .form-group
          label Salaries (ugx): 
          input(type="number", name="salaries", required, value=data.salaries || "", style="width: 100%; box-sizing: border-box;")
        .form-group
          label Rent (ugx): 
          input(type="number", name="rent", required, value=data.rent || "", style="width: 100%; box-sizing: border-box;")
        .form-group
          label Utilities (ugx): 
          input(type="number", name="utilities", required, value=data.utilities || "", style="width: 100%; box-sizing: border-box;")
        .form-group
          label Marketing (ugx): 
          input(type="number", name="marketing", required, value=data.marketing || "", style="width: 100%; box-sizing: border-box;")
        .form-group
          label Cash Flow (comma separated): 
          input(type="text", name="cashFlow", placeholder="5000,6000,7000", value=data.cashFlow ? data.cashFlow.join(",") : "", style="width: 100%; box-sizing: border-box;")
        .form-group
          label Receivables (ugx): 
          input(type="number", name="receivables", required, value=data.receivables || "", style="width: 100%; box-sizing: border-box;")
        .form-group
          label Payables (ugx): 
          input(type="number", name="payables", required, value=data.payables || "", style="width: 100%; box-sizing: border-box;")
        .form-group(style="text-align: center; margin-top: 20px;")
          button(type="submit", style="padding: 10px 30px; background-color: #5d4037; color: white; border: none; border-radius: 4px; cursor: pointer;") Update Dashboard

    .grid(style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; width: calc(100% - 80px); margin-left: 40px; margin-right: 40px; padding: 0 40px; box-sizing: border-box;")
      .card(style="background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; min-height: 300px;")
        h2 Profit & Loss
        canvas#plChart
      .card(style="background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; min-height: 300px;")
        h2 Expenses Breakdown
        canvas#expenseChart
      .card(style="background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; min-height: 300px;")
        h2 Cash Flow
        canvas#cashChart
      .card(style="background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; min-height: 300px;")
        h2 Receivables vs Payables
        canvas#arApChart

              // Inject server data into JS variables
        script.
          const sales = !{data.sales || 0};
          const cogs = !{data.cogs || 0};
          const expenses = !{data.expenses || 0};
          const salaries = !{data.salaries || 0};
          const rent = !{data.rent || 0};
          const utilities = !{data.utilities || 0};
          const marketing = !{data.marketing || 0};
          const cashFlow = !{JSON.stringify(data.cashFlow || [])};
          const receivables = !{data.receivables || 0};
          const payables = !{data.payables || 0};

        script(src="/Javascript/accounting.js")

    // Logout Confirmation Modal
    #logoutModal.modal(style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);")
      .modal-content(style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);")
        .modal-header(style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;")
          h3(style="margin: 0; color: #d9534f;") Confirm Logout
        .modal-body(style="margin-bottom: 20px;")
          p#logoutMessage(style="margin: 0;") Are you sure you want to log out?
        .modal-footer(style="text-align: right;")
          button.btn.btn-danger(type="button", onclick="confirmLogout()") Logout
          button.btn.btn-secondary(type="button", onclick="closeLogoutModal()", style="margin-left: 10px;") Cancel

    footer
      
      .footer-bottom.
        © 2025 Mayondo Wood and Furniture. All rights reserved.

    script.
      function showLogoutConfirmation() {
        document.getElementById('logoutModal').style.display = 'block';
      }

      function closeLogoutModal() {
        document.getElementById('logoutModal').style.display = 'none';
      }

      function confirmLogout() {
        // Redirect to logout route which will destroy session and redirect to index
        window.location.href = '/logout';
      }

      // Close modal when clicking outside of it
      window.onclick = function(event) {
        const modal = document.getElementById('logoutModal');
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      }