extends layout

block content
  h1 Customers
  
  // Search functionality
  .search-container(style="margin-bottom: 20px;")
    input#search-customers-table(type="text", placeholder="üîç Search customers...", style="padding: 8px; width: 300px; border: 1px solid #ccc; border-radius: 4px;")

  if customers && customers.length
    table#customers-table(data-search="true", style="width: 100%; border-collapse: collapse; margin-top: 20px;")
      thead
        tr(style="background-color: #f5f5f5;")
          th(style="padding: 10px; border: 1px solid #ddd;") Name
          th(style="padding: 10px; border: 1px solid #ddd;") Email
          th(style="padding: 10px; border: 1px solid #ddd;") Phone
          th(style="padding: 10px; border: 1px solid #ddd;") Actions
      tbody
        each customer in customers
          tr
            td(style="padding: 10px; border: 1px solid #ddd;")= customer.name
            td(style="padding: 10px; border: 1px solid #ddd;")= customer.email
            td(style="padding: 10px; border: 1px solid #ddd;")= customer.phone || 'N/A'
            td(style="padding: 10px; border: 1px solid #ddd;")
              // Only show buttons if staff is logged in
              if isStaff
                button.edit(style="margin-right: 5px; padding: 5px 10px;", onclick=`editCustomer('${customer._id}')`) Edit
                button.delete(style="padding: 5px 10px;", onclick=`showDeleteConfirmation('${customer._id}', '${customer.name}', 'customer')`) Delete
  else
    p No customers found.

  // Include search script
  script(src="/Javascript/search.js")

  // Delete Confirmation Modal
  #deleteModal.modal(style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);")
    .modal-content(style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);")
      .modal-header(style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;")
        h3(style="margin: 0; color: #d9534f;") Confirm Deletion
      .modal-body(style="margin-bottom: 20px;")
        p#deleteMessage(style="margin: 0;") Are you sure you want to delete this customer?
        p(style="margin: 10px 0 0 0; font-weight: bold;") #[span#deleteDetails]
      .modal-footer(style="text-align: right;")
        form#deleteForm(method="post", style="display: inline;")
          button.btn.btn-danger(type="submit") Delete
        button.btn.btn-secondary(type="button", onclick="closeDeleteModal()", style="margin-left: 10px;") Cancel

  script.
    function showDeleteConfirmation(customerId, customerName, customerType) {
      document.getElementById('deleteMessage').textContent = `Are you sure you want to delete this ${customerType}?`;
      document.getElementById('deleteDetails').textContent = `${customerName}`;
      document.getElementById('deleteForm').action = `/customers/delete/${customerId}`;
      document.getElementById('deleteModal').style.display = 'block';
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').style.display = 'none';
    }

    // Close modal when clicking outside of it
    window.onclick = function(event) {
      const modal = document.getElementById('deleteModal');
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    }
