doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title Manager Dashboard
    link(rel="stylesheet", href="/CSS/staff.css")

  body

    // Navbar - back to top
    header.navbar
      .brand
        a(href="/")
          img(src="/Images/mayondo logo.png", alt="Company Logo")
        h2 Mayondo Wood And Furniture
      nav.nav-links
        a(href="/saleslist") Sales
        a(href="/stafflist", style="text-decoration: none;") Register
        .dropdown
          a(href="/analytic") Reports ▼
          .dropdown-content
            a(href="/accounting") Accounting
             a(href="/dashboard") Manager
            a(href="/suppliers") Suppliers
        a(href="/stockreport") Stock
        if user
          a(href="#" onclick="showLogoutConfirmation()" class="btn-logout" style="background-color: red; color: white; padding: 8px 16px; border-radius: 4px; text-decoration: none; display: inline-block;") Logout
    if success
      .alert.alert-success.alert-dismissible.fade.show(style="margin: 20px;", role="alert")
        strong Success!
        = success
        button.btn-close(type="button", data-bs-dismiss="alert", aria-label="Close")

    // Table Section
    .table-header(style="display:flex; justify-content:space-between; align-items:center; margin:20px 0;")
      h2 Registered Staff Users
      a(href="/register",
        style="padding:8px 16px; background-color:brown; color:white; text-decoration:none; border-radius:4px; font-size:14px;")
        Register Add Staff

    table
      thead
        tr
          th(style="font-size: 12px; padding: 8px 4px;") Full Name
          th(style="font-size: 12px; padding: 8px 4px;") Email
          th(style="font-size: 12px; padding: 8px 4px;") Phone
          th(style="font-size: 12px; padding: 8px 4px;") Address
          th(style="font-size: 12px; padding: 8px 4px;") NIN
          th(style="font-size: 12px; padding: 8px 4px;") Staff ID
          th(style="font-size: 12px; padding: 8px 4px;") Position
          th(style="font-size: 12px; padding: 8px 4px;") Next of Kin
          th(style="font-size: 12px; padding: 8px 4px;") Kin Phone
          th(style="font-size: 12px; padding: 8px 4px;") Registered
          if user && user.position === 'manager'
            th(style="font-size: 12px; padding: 8px 4px;") Actions

      tbody
        if users && users.length
          each staff in users
            tr
              td= staff.fullname
              td= staff.email
              td= staff.phone
              td= staff.address
              td= staff.nin
              td= staff.staffId
              td= staff.position
              td= staff.nextOfKin
              td= staff.nextOfKinPhone
              td= new Date(staff.createdAt).toLocaleString()
              if user && user.position === 'manager'
                td(style="white-space: nowrap; min-width: 100px;")
                  a(href=`/staff/edit/${staff._id}`, style="display:inline-block; padding:4px 8px; margin-right:12px; background-color:burlywood; color:white; text-decoration:none; border-radius:4px; font-size:13px; cursor:pointer;") Edit
                  button(type="button", onclick=`showDeleteConfirmation('${staff._id}', '${staff.fullname}', 'staff member')`, style="padding:4px 8px; margin-left:6px; background-color:red; color:white; border:none; border-radius:4px; cursor:pointer; font-size:13px;") Delete
        else
          tr
            td(colspan= user && user.position === 'manager' ? 11 : 10) No users found

    // Delete Confirmation Modal
    #deleteModal.modal(style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);")
      .modal-content(style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);")
        .modal-header(style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;")
          h3(style="margin: 0; color: #d9534f;") Confirm Deletion
        .modal-body(style="margin-bottom: 20px;")
          p#deleteMessage(style="margin: 0;") Are you sure you want to delete this staff member?
          p(style="margin: 10px 0 0 0; font-weight: bold;") #[span#deleteDetails]
        .modal-footer(style="text-align: right;")
          form#deleteForm(method="post", style="display: inline;")
            button.btn.btn-danger(type="submit") Delete
          button.btn.btn-secondary(type="button", onclick="closeDeleteModal()", style="margin-left: 10px;") Cancel

    // Logout Confirmation Modal
    #logoutModal.modal(style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);")
      .modal-content(style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);")
        .modal-header(style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;")
          h3(style="margin: 0; color: #d9534f;") Confirm Logout
        .modal-body(style="margin-bottom: 20px;")
          p#logoutMessage(style="margin: 0;") Are you sure you want to log out?
        .modal-footer(style="text-align: right;")
          button.btn.btn-danger(type="button", onclick="confirmLogout()") Logout
          button.btn.btn-secondary(type="button", onclick="closeLogoutModal()", style="margin-left: 10px;") Cancel

    script.
      function showDeleteConfirmation(staffId, staffName, staffType) {
        document.getElementById('deleteMessage').textContent = `Are you sure you want to delete this ${staffType}?`;
        document.getElementById('deleteDetails').textContent = `${staffName}`;
        document.getElementById('deleteForm').action = `/staff/delete/${staffId}`;
        document.getElementById('deleteModal').style.display = 'block';
      }

      function closeDeleteModal() {
        document.getElementById('deleteModal').style.display = 'none';
      }

      function showLogoutConfirmation() {
        document.getElementById('logoutModal').style.display = 'block';
      }

      function closeLogoutModal() {
        document.getElementById('logoutModal').style.display = 'none';
      }

      function confirmLogout() {
        // Redirect to logout route which will destroy session and redirect to index
        window.location.href = '/logout';
      }

      // Close modal when clicking outside of it
      window.onclick = function(event) {
        const deleteModal = document.getElementById('deleteModal');
        const logoutModal = document.getElementById('logoutModal');
        if (event.target === deleteModal) {
          deleteModal.style.display = 'none';
        }
        if (event.target === logoutModal) {
          logoutModal.style.display = 'none';
        }
      }

    // ✅ Content ends here

    // Footer - static at bottom
    footer(style="position: fixed; bottom: 0; left: 0; right: 0; background-color: #5d4037; color: white; text-align: center; padding: 10px; border-top: 1px solid #ddd;")
      .footer-bottom
        | © 2025 Your Company Name. All rights reserved.
.