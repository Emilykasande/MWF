doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title Manager Dashboard
    link(rel="stylesheet", href="/CSS/salesreport.css")

  body
    // Navbar
    header.navbar
      .brand
        a(href="/")
          img(src="/Images/mayondo logo.png", alt="Company Logo")
        h2 Mayondo Wood And Furniture
      nav.nav-links
        a(href="/saleslist") Sales
        a(href="/stafflist") Register
        .dropdown
          a(href="/analytic") Reports â–¼
          .dropdown-content
            a(href="/accounting") Accounting
            a(href="/stafflist") Staff
            a(href="/suppliers") Suppliers
        a(href="/stockreport") Stock
        if user
          a.btn-logout(href="/logout") Logout

    // Main Content
    main.container
      .card
        h2 Sales Report

        if user && user.position === "manager"
          .d-flex(style="display:flex; justify-content:flex-end; margin-bottom:15px;")
            form(method="get", action="/salesreport")
              button.btn.btn-success(type="submit") ðŸ“‘ Generate Sales Report

        table#salesTable
          thead
            tr
              th Customer
              th Product
              th Quantity
              th Unit Price
              th Total Price
              th Transport
              th Agent
              th Payment
              th Date
              th Actions
          tbody
            if sales && sales.length
              each sale in sales
                tr
                  td= sale.customername
                  td= sale.product
                  td= sale.quantity
                  td UGX #{sale.price}
                  td UGX #{sale.totalprice ? sale.totalprice.toFixed(2) : (sale.quantity * sale.price).toFixed(2)}
                  td= sale.transport || "N/A"
                  td= sale.salesAgent ? sale.salesAgent.fullname : "Unknown"
                  td= sale.paymentMethod
                  td= sale.formattedDate
                  td
                    if user && user.position === "manager"
                      form(method="get", action=`/editsale/${sale._id}`, style="display:inline")
                        button.btn.btn-primary(type="submit") Edit
                      button.btn.btn-danger(type="button", onclick=`showDeleteConfirmation('${sale._id}', '${sale.customername}', '${sale.product}')`, style="margin-left:5px;") Delete
            else
              tr
                td(colspan="10") No sales recorded yet.

    // Script
    script(src="/Javascript/search.js")

    // Delete Confirmation Card
    #deleteModal.modal(style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);")
      .modal-content(style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);")
        .modal-header(style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;")
          h3(style="margin: 0; color: #d9534f;") Confirm Deletion
        .modal-body(style="margin-bottom: 20px;")
          p#deleteMessage(style="margin: 0;") Are you sure you want to delete this sale?
          p(style="margin: 10px 0 0 0; font-weight: bold;") #[span#deleteDetails]
        .modal-
    // Logout Confirmation Modal
    #logoutModal.modal(style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);")
      .modal-content(style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);")
        .modal-header(style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;")
          h3(style="margin: 0; color: #d9534f;") Confirm Logout
        .modal-body(style="margin-bottom: 20px;")
          p#logoutMessage(style="margin: 0;") Are you sure you want to log out?
        .modal-footer(style="text-align: right;")
          button.btn.btn-danger(type="button", onclick="confirmLogout()") Logout
          button.btn.btn-secondary(type="button", onclick="closeLogoutModal()", style="margin-left: 10px;") Cancel

    script.
      function showLogoutConfirmation() {
        document.getElementById('logoutModal').style.display = 'block';
      }

      function closeLogoutModal() {
        document.getElementById('logoutModal').style.display = 'none';
      }

      function confirmLogout() {
        // Redirect to logout route
        window.location.href = '/logout';
      }

      // Close modal when clicking outside of it
      window.onclick = function(event) {
        const modal = document.getElementById('logoutModal');
        if (event.target === modal) {
          modal.style.display = 'none';
        }
footer
  .footer-bottom
    | Â© 2025 Mayondo Wood and Furniture. All rights reserved.


